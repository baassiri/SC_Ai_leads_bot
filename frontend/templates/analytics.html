{% extends 'base.html' %}

{% block title %}Analytics - SC AI{% endblock %}
{% block page_title %}Analytics Dashboard{% endblock %}

{% block extra_styles %}
.chart-container {
    position: relative;
    height: 300px;
}
.stat-card {
    transition: transform 0.2s;
}
.stat-card:hover {
    transform: translateY(-2px);
}
{% endblock %}

{% block content %}
<!-- KPIs -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Total Leads</p>
                <h3 class="text-2xl font-bold mt-1" id="totalLeads">0</h3>
            </div>
            <div class="bg-blue-100 p-3 rounded-full">
                <i data-feather="users" class="w-5 h-5 text-secondary"></i>
            </div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Qualified Leads</p>
                <h3 class="text-2xl font-bold mt-1" id="qualifiedLeads">0</h3>
                <p class="text-sm text-gray-500 mt-1"><span id="qualificationRate">0</span>% rate</p>
            </div>
            <div class="bg-green-100 p-3 rounded-full">
                <i data-feather="check-circle" class="w-5 h-5 text-success"></i>
            </div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Avg Lead Score</p>
                <h3 class="text-2xl font-bold mt-1"><span id="avgScore">0</span>/100</h3>
            </div>
            <div class="bg-purple-100 p-3 rounded-full">
                <i data-feather="star" class="w-5 h-5 text-purple-500"></i>
            </div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Messages Sent</p>
                <h3 class="text-2xl font-bold mt-1" id="messagesSent">0</h3>
                <p class="text-sm text-gray-500 mt-1"><span id="sentToday">0</span> today</p>
            </div>
            <div class="bg-yellow-100 p-3 rounded-full">
                <i data-feather="send" class="w-5 h-5 text-warning"></i>
            </div>
        </div>
    </div>
</div>

<!-- A/B Test Winner Detection -->
<div class="bg-white rounded-lg shadow p-6 mb-8">
    <div class="flex justify-between items-center mb-4">
        <div>
            <h2 class="text-lg font-semibold text-gray-800">A/B Test Winner Detection</h2>
            <p class="text-sm text-gray-600">Automatically detect winning message variants</p>
        </div>
        <button onclick="autoAnalyzeTests()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center">
            <i data-feather="zap" class="w-4 h-4 mr-2"></i>
            Auto-Analyze All Tests
        </button>
    </div>
    
    <div id="winnerResults"></div>
    <div id="bestPractices" class="mt-6"></div>
</div>

<!-- Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Leads Over Time</h2>
        <div class="chart-container">
            <canvas id="leadsOverTimeChart"></canvas>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Leads by Persona</h2>
        <div class="chart-container">
            <canvas id="leadsByPersonaChart"></canvas>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Lead Status</h2>
        <div class="chart-container">
            <canvas id="leadStatusChart"></canvas>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Message Performance (A/B/C)</h2>
        <div class="chart-container">
            <canvas id="messagePerformanceChart"></canvas>
        </div>
    </div>
</div>

<!-- Schedule Status -->
<div class="bg-white rounded-lg shadow p-6 mb-8">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-800">Scheduled Messages</h2>
        <span class="text-sm text-gray-500"><span id="scheduledMessages">0</span> pending</span>
    </div>
    <div class="chart-container">
        <canvas id="scheduleTimelineChart"></canvas>
    </div>
</div>

<!-- Actions -->
<div class="bg-white rounded-lg shadow p-6 flex justify-between items-center">
    <div>
        <h2 class="text-lg font-semibold text-gray-800">Export Analytics</h2>
        <p class="text-sm text-gray-600 mt-1">Download detailed reports</p>
    </div>
    <div class="flex space-x-3">
        <button id="refreshBtn" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-md text-sm flex items-center">
            <i data-feather="refresh-cw" class="w-4 h-4 mr-1"></i> Refresh
        </button>
        <button id="exportBtn" class="bg-secondary hover:bg-blue-500 text-white px-4 py-2 rounded-md text-sm flex items-center">
            <i data-feather="download" class="w-4 h-4 mr-1"></i> Export CSV
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
<script src="{{ url_for('static', filename='js/ab-winner-ui.js') }}"></script>
{% endblock %}